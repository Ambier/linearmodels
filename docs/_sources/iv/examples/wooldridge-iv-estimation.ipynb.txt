{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Basic Examples"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Instrumental Variables estimation and two Stage Least Squares\n",
    "\n",
    "**Chapter 15**\n",
    "_Introduction to Econometrics_, Jeffrey Wooldridge"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": false
   },
   "outputs": [],
   "source": [
    "%matplotlib inline\n",
    "import seaborn as sns\n",
    "sns.mpl.rcParams['figure.figsize'] = (20,12)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": false
   },
   "outputs": [],
   "source": [
    "import numpy as np\n",
    "from statsmodels.api import add_constant\n",
    "from linearmodels.datasets import mroz\n",
    "data = mroz.load()\n",
    "data = data.dropna()\n",
    "data = add_constant(data, has_constant='add')\n",
    "data.dtypes"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": false,
    "scrolled": true
   },
   "outputs": [],
   "source": [
    "from linearmodels import iv\n",
    "res = iv.IV2SLS(np.log(data.wage), data[['const','educ']], None, None).fit('unadjusted')\n",
    "print(res.summary)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": false
   },
   "outputs": [],
   "source": [
    "res_first = iv.IV2SLS(data.educ, data[['const','fatheduc']], None, None).fit('unadjusted')\n",
    "print(res_first.summary)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": false
   },
   "outputs": [],
   "source": [
    "data['educ_hat'] = data.educ - res.resids\n",
    "res_second = iv.IV2SLS(np.log(data.wage), data[['const']], data.educ, data.fatheduc).fit('unadjusted')\n",
    "print(res_second.summary)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": false
   },
   "outputs": [],
   "source": [
    "from linearmodels.datasets import wage\n",
    "men = wage.load()\n",
    "men = men[['educ','wage','sibs']]\n",
    "men = add_constant(men)\n",
    "men = men.dropna()\n",
    "res_first = iv.IV2SLS(men.educ, men[['const', 'sibs']], None, None).fit('unadjusted')\n",
    "print(res_first.summary)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": false
   },
   "outputs": [],
   "source": [
    "res = iv.IV2SLS(np.log(men.wage), men.const, men.educ, men.sibs).fit('unadjusted')\n",
    "print(res.summary)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": false
   },
   "outputs": [],
   "source": [
    "from linearmodels.datasets import card\n",
    "data = card.load()\n",
    "data = add_constant(data)\n",
    "data.dtypes\n",
    "dep = ['wage']\n",
    "endog = ['educ']\n",
    "exog = ['const','exper','expersq','black','smsa','south','smsa66','reg662',\n",
    "       'reg663','reg664','reg665','reg666','reg667','reg668','reg669']\n",
    "instr = ['nearc4']\n",
    "data = data[dep +exog+endog+ instr].dropna()\n",
    "res = iv.IV2SLS(data.educ, data[instr+exog], None, None).fit()\n",
    "print(res.summary)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": false
   },
   "outputs": [],
   "source": [
    "res = iv.IV2SLS(np.log(data.wage), data[exog+endog],None,None).fit()\n",
    "print(res.summary)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": false
   },
   "outputs": [],
   "source": [
    "res = iv.IV2SLS(np.log(data.wage), data[exog], data[endog], data[instr]).fit()\n",
    "print(res.summary)"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3.0
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.5.3"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 0
}